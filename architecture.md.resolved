# ğŸ—ï¸ Antigravity Lab â€” Architecture

## Vue d'ensemble

```mermaid
graph TB
    subgraph IDE["ğŸ’» IDE â€” Antigravity"]
        GEM["ğŸ§  Gemini<br/>Orchestrateur natif<br/>Planification Â· Coordination Â· Ã‰dition"]
    end

    subgraph CLI["âš¡ agents-cli.js"]
        ORC["Orchestrator"]
        ORC --> AGT1["Agent coder"]
        ORC --> AGT2["Agent reviewer"]
        ORC --> AGT3["Agent tester"]
        ORC --> AGT4["Agent architect"]
        ORC --> AGT5["Agent debugger"]
        ORC --> AGT6["Agent researcher"]
    end

    subgraph APIs["â˜ï¸ APIs Externes"]
        DS["DeepSeek<br/>api.deepseek.com"]
        KM["Kimi/Moonshot<br/>api.moonshot.ai"]
    end

    GEM -->|"run_command"| ORC
    AGT1 & AGT2 & AGT3 & AGT4 & AGT5 --> DS
    AGT6 --> KM
```

### RÃ©partition des responsabilitÃ©s

| Couche | Agent | RÃ´le |
|---|---|---|
| ğŸ§  **Gemini** (natif) | Antigravity | Chef d'orchestre, planification, brainstorming, Ã©dition fichiers |
| â˜ï¸ **DeepSeek** (CLI) | coder, reviewer, tester, architect, debugger | Code, revue, tests, design, debug |
| â˜ï¸ **Kimi** (CLI) | researcher | Analyse longue, documentation, rÃ©sumÃ©s |

---

## Arborescence

```
antigravity lab/
â”œâ”€â”€ .agents/
â”‚   â”œâ”€â”€ agents/
â”‚   â”‚   â””â”€â”€ code-reviewer.md
â”‚   â”œâ”€â”€ skills/                       # 15 skills
â”‚   â”‚   â”œâ”€â”€ brainstorming/
â”‚   â”‚   â”œâ”€â”€ dispatching-parallel-agents/
â”‚   â”‚   â”œâ”€â”€ executing-plans/
â”‚   â”‚   â”œâ”€â”€ finishing-a-development-branch/
â”‚   â”‚   â”œâ”€â”€ multi-model-orchestration/  â˜…
â”‚   â”‚   â”œâ”€â”€ receiving-code-review/
â”‚   â”‚   â”œâ”€â”€ requesting-code-review/
â”‚   â”‚   â”œâ”€â”€ subagent-driven-development/
â”‚   â”‚   â”œâ”€â”€ systematic-debugging/
â”‚   â”‚   â”œâ”€â”€ test-driven-development/
â”‚   â”‚   â”œâ”€â”€ using-git-worktrees/
â”‚   â”‚   â”œâ”€â”€ using-superpowers/
â”‚   â”‚   â”œâ”€â”€ verification-before-completion/
â”‚   â”‚   â”œâ”€â”€ writing-plans/
â”‚   â”‚   â””â”€â”€ writing-skills/
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ brainstorm.md
â”‚       â”œâ”€â”€ execute-plan.md
â”‚       â”œâ”€â”€ orchestrate.md            â˜…
â”‚       â””â”€â”€ write-plan.md
â”‚
â”œâ”€â”€ lib/orchestrator/                 # Moteur multi-modÃ¨les
â”‚   â”œâ”€â”€ config.js         (4.2 KB)   # Providers, rÃ´les, prompts
â”‚   â”œâ”€â”€ llm-client.js     (3.4 KB)   # Client OpenAI-compatible
â”‚   â”œâ”€â”€ agent.js           (3.1 KB)   # Classe Agent
â”‚   â”œâ”€â”€ orchestrator.js   (9.4 KB)   # 3 modes d'exÃ©cution
â”‚   â”œâ”€â”€ task-manager.js   (4.0 KB)   # Gestion tÃ¢ches
â”‚   â””â”€â”€ output-formatter.js (4.1 KB) # Formatage rÃ©sultats
â”‚
â”œâ”€â”€ agents-cli.js         (9.1 KB)   # CLI d'orchestration
â”œâ”€â”€ .env                              # ClÃ©s API (DEEPSEEK, KIMI)
â”œâ”€â”€ package.json                      # openai, dotenv
â””â”€â”€ superpowers/                      # Repo source Superpowers
```

---

## Moteur d'orchestration

### Classes

```mermaid
classDiagram
    class Orchestrator {
        +addAgent(config) Agent
        +runParallel(assignments) Result
        +runSequential(steps) Result
        +runPipeline(task, opts) Result
        +ask(agentName, task) Result
        +getSummary() Summary
    }

    class Agent {
        -name, role, provider, model
        -history[], results[]
        +execute(task) Result
        +resetHistory()
        +getInfo() Object
    }

    class LLMClient {
        -clients: Map
        +chat(provider, model, msgs) Response
        +testConnection(provider) TestResult
    }

    class TaskManager {
        -tasks: Map
        +addTask() / assignTask()
        +completeTask() / failTask()
        +getNextAvailable() Task
        +toMarkdown() string
    }

    Orchestrator --> Agent
    Orchestrator --> TaskManager
    Agent --> LLMClient
    LLMClient --> Config
```

### 3 modes d'exÃ©cution

```mermaid
graph LR
    subgraph P["âš¡ Parallel"]
        P1["Agent 1"] 
        P2["Agent 2"]
        P3["Agent 3"]
    end

    subgraph S["ğŸ”— Sequential"]
        S1["Agent 1"] -->|ctx| S2["Agent 2"] -->|ctx| S3["Agent 3"]
    end

    subgraph PL["ğŸ”„ Pipeline"]
        R["ğŸ” Researcher<br/>Kimi"] -->|analyse| C["ğŸ’» Coder<br/>DeepSeek"]
        C -->|code| T["ğŸ§ª Tester<br/>DeepSeek"]
        T -->|tests| V["ğŸ“‹ Reviewer<br/>DeepSeek"]
    end
```

| Mode | Usage |
|---|---|
| **Parallel** | TÃ¢ches indÃ©pendantes simultanÃ©es |
| **Sequential** | ChaÃ®ne avec rÃ©sultat prÃ©cÃ©dent en contexte |
| **Pipeline** | Research â†’ Code â†’ Test â†’ Review |

---

## Providers & RÃ´les

| Provider | Base URL | ModÃ¨les |
|---|---|---|
| **DeepSeek** | `api.deepseek.com` | `deepseek-chat`, `deepseek-reasoner` |
| **Kimi** | `api.moonshot.ai/v1` | `moonshot-v1-auto`, `v1-8k/32k/128k` |

| RÃ´le | Provider | SpÃ©cialitÃ© |
|---|---|---|
| ğŸ’» `coder` | DeepSeek | Code, algorithmes, refactoring |
| ğŸ“‹ `reviewer` | DeepSeek | Revue de code, bugs, qualitÃ© |
| ğŸ§ª `tester` | DeepSeek | Tests, edge cases, couverture |
| ğŸ—ï¸ `architect` | DeepSeek | Design systÃ¨me, patterns |
| ğŸ› `debugger` | DeepSeek | Analyse d'erreurs, hypothÃ¨ses |
| ğŸ” `researcher` | Kimi | Analyse longue, docs, rÃ©sumÃ©s |

---

## CLI â€” Commandes

```bash
node agents-cli.js test [--provider <name>]
node agents-cli.js ask --role <role> "<question>"
node agents-cli.js pipeline --task "<tÃ¢che>" [--stages <s1,s2>]
node agents-cli.js parallel --tasks '<json>'
node agents-cli.js roles
node agents-cli.js providers
```

---

## Flux de donnÃ©es

```mermaid
sequenceDiagram
    participant U as ğŸ‘¤ Utilisateur
    participant G as ğŸ§  Gemini (Antigravity)
    participant CLI as âš¡ agents-cli.js
    participant DS as â˜ï¸ DeepSeek
    participant KM as â˜ï¸ Kimi

    U->>G: "ImplÃ©mente un cache LRU"
    G->>CLI: pipeline --task "cache LRU"
    CLI->>KM: ğŸ” RESEARCHER
    KM-->>CLI: Analyse
    CLI->>DS: ğŸ’» CODER
    DS-->>CLI: Code
    CLI->>DS: ğŸ§ª TESTER
    DS-->>CLI: Tests
    CLI->>DS: ğŸ“‹ REVIEWER
    DS-->>CLI: Review
    CLI-->>G: Rapport complet
    G-->>U: Code + Tests + Review intÃ©grÃ©s
```

---

## DÃ©pendances

| Package | Usage |
|---|---|
| `openai` ^4.77.0 | SDK pour APIs OpenAI-compatibles |
| `dotenv` ^16.4.7 | Chargement [.env](file:///c:/Users/taouf/Documents/antigravity%20lab/.env) |
| **Node.js** v24.12.0 | Runtime |
